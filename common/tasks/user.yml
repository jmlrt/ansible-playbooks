---
# user management tasks

- name: ensure user exists
  user:
    name: "{{ user }}"
    state: present
    password: "{{ lookup('file','files/private-{{ user }}.passwd') }}"
    shell: /bin/bash

- name: ensure user public key exists
  authorized_key:
    user: "{{ user }}"
    key: "{{ lookup('file','files/private-{{ user }}.pub') }}"
    state: present
    manage_dir: yes

- name: ensure user can use sudo
  lineinfile:
    dest: /etc/sudoers
    state: present
    regexp: '^{{ user }} ALL\='
    line: '{{ user }} ALL=(ALL) NOPASSWD:ALL'
    validate: 'visudo -cf %s'
